var jpdbBaseURL = "http://api.login2explore.com:5577";
var jpdbIRL = "/api/irl";
var jpdbIML = "/api/iml";
var stdDBName = "SCHOOL-DB";
var stdRelationName = "Student-table";
var connToken ="90932550|-31949277541076339|90949266";
                                 

$('#stdid').focus();

function saveRecNo2LS(jsonObj) {
         var lvData = JSON.parse(jsonObj.data);
         localStorage.setItem('recno', lvData.rec_no);
}


function getStdIdAsJsonObj() {
         var stdid = $("#stdid").val();
         var jsonStr = {
                id: stdid
         };
         returnJSON.stringify(jsonStr);
} 

function fillData(jsonObj) {
         saveRecNo2LS(jsonObj);
         var data = JSON.parse(jsonObj.data).record;
         $("#stdid").val(data.id);
         $("#stdname").val(data.name);
         $("#stdbday").val(data.birthdate);
         $("#stdclass").val(data.class);
         $("#stdadd").val(data.address);
         $("#stded").val(data.enrollmentdate);
}

function resetForm() {
         $("#stdid").val(" ");
         $("#stdname").val(" ");
         $("#stdclass").val(" ");
         $("#stdbday").val(" ");
         $("#stdadd").val(" ");
         $("#stded").val(" ");
         $("#stdid").prop("disabled", false);
         $("#save").prop("disabled", true);
         $("#update").prop("disabled", true);
         $("#reset").prop("disabled", true);
         $("#stdid").focus();
}

function validateData() {
         var stdid, stdname, stdclass, stdbday,stdadd, stded;
         stdid = $("#stdid").val();
         stdname = $("#stdname").val();
         stdclass =$("#stdclass").val();
         stdbday = $("#stdbday").val();
         stdadd = $("#stdadd").val();
         stded =$("#stded").val();
         
         if (stdid === " ") {
              alert("Student Roll No is missing");
              $("#stdid").focus();
              return " ";
         }
         if (stdname === " ") {
              alert("Student Name is  missing");
              $("#stdname").focus();
              return " ";
         }
         if (stdclass === " ") {
              alert("Student Class is missing");
              $("#stdclass").focus();
              return " ";
         }
         if (stdbday === " ") {
              alert("Student Birthdate is missing");
              $("#stdbday").focus();
              return " ";
         }
         if (stdadd=== " ") {
              alert("Student Address is missing");
              $("#stdadd").focus();
              return " ";
         }
         if (stded === " ") {
              alert("Student Enrollment No is missing");
              $("#stded").focus();
              return " ";
         }
        
         var jsonStrObj = {
         id: stdid;
         name:stdname;
         class:stdclass;
         birthdate:stdbday;
         address:stdadd;
         enrollmentdate:stded;

         };
         return JSON.stringify(jsonStrObj);
}

function getStd() {
         var stdIdJsonObj = getStdIdAsJsonObj();
         var getRequest = createGET_BY_KEYRequest(connToken, stdDBName, stdRelationName, stdIdJsonObj);
          jQuery.ajaxSetup({async: false});
         var resJsonObj = executeCommandAtGivenBaseUrl(getRequest, jpdbBaseURL, jpdbIRL);
          jQuery.ajaxSetup({async: true});
         if (resJsonObj.status === 400) {
             $("#save").prop("disabled", false);
             $("#reset").prop("disabled", false);
             $("#stdname").focus();
         }
         else if (resJsonObj.status === 200) {
             $("stdid").prop("disabled", true);
             fillData(resJsonObj);

             $("#update").prop("disabled", false);
             $("#reset").prop("disabled", false);
             $("#stdname").focus();
         }
}  





function saveData() {
         var jsonStrObj = validateData();
         if (jsonStrObj ==='  ') {
              return "  ";
         }
         var putRequest = createPUTRequest(connToken, jsonStrObj, stdDBName, stdRelationName);
         jQuery.ajaxSetup({async: false});
         var resJsonObj = executeCommandAtGivenBaseUrl(putRequest, jpdbBaseURL, jpdbIML);
         jQuery.ajaxSetup({async: true});
         resetForm();
         $("#stdid").focus();
}

function changeData() { 
        $("#update").prop("disabled", true);  
        jsonChg = validateData();
        var updateRequest = createUPDATERecordRequest(connToken, jsonChg, stdDBName, stdRelationName, localstorage.getItem('recno'));
        jQuery.ajaxSetup({async: false});
        var resJsonObj = executeCommandAtGivenBaseUrl(updateRequest, jpdbBaseURL, jpdbIML);
        jQuery.ajaxSetup({async: true});
        console.log(resJsonObj);
        resetForm();
        $("#stdid").focus();
}